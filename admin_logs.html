<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Logs d'Activité – Admin</title>
  
  <link rel="icon" href="/sources/img/logo_tmp.png" type="image/png">
  <link rel="stylesheet" href="/sources/css/style_global.css">
  <link rel="stylesheet" href="/sources/css/style_admin_web.css">
  <link rel="stylesheet" href="/sources/css/style_admin_logs.css">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="/js/config.js"></script>
  <script defer src="/js/auth.js"></script>
</head>

<body>
  <!-- Header Admin -->
  <header class="admin-top-header">
    <div class="admin-top-header-content">
      <div class="admin-top-logo">
        <img src="/sources/img/logo_tmp.png" alt="Au Format">
        <span class="admin-top-title">Au Format - Admin</span>
      </div>
      <nav class="admin-top-nav">
        <a href="/">🏠 Retour au site</a>
        <a href="/profile.html">👤 Mon profil</a>
        <a href="#" onclick="AUTH.logout(); return false;">🚪 Déconnexion</a>
      </nav>
    </div>
  </header>

  <!-- Sidebar -->
  <aside class="admin-sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <img src="/sources/img/logo_tmp.png" alt="Au Format">
        <div>
          <div class="sidebar-title">Au Format</div>
          <div class="admin-badge">⚡ ADMIN</div>
        </div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section-title">Tableau de bord</div>
      <a href="/admin_web.html" class="nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"></rect>
          <rect x="14" y="3" width="7" height="7"></rect>
          <rect x="14" y="14" width="7" height="7"></rect>
          <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
        Vue d'ensemble
      </a>

      <div class="nav-section-title">Gestion</div>
      <a href="/admin_clients.html" class="nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        Clients
      </a>

      <a href="/admin_quotes.html" class="nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
        </svg>
        Devis
      </a>

      <a href="/admin_projects.html" class="nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        </svg>
        Projets
      </a>

      <div class="nav-section-title">Paramètres</div>
      <a href="/admin_settings.html" class="nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M12 1v6m0 6v6M5.6 5.6l4.2 4.2m4.2 4.2l4.2 4.2M1 12h6m6 0h6M5.6 18.4l4.2-4.2m4.2-4.2l4.2-4.2"></path>
        </svg>
        Configuration
      </a>

      <a href="/admin_logs.html" class="nav-link active">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="12" y1="18" x2="12" y2="12"></line>
          <line x1="9" y1="15" x2="15" y2="15"></line>
        </svg>
        Logs d'activité
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="admin-content">
    <div class="admin-header">
      <div>
        <h1>📋 Logs d'Activité</h1>
        <p style="color: #64748b; margin-top: 8px;">Historique complet des actions sur la plateforme</p>
      </div>
      <div class="admin-header-actions">
        <button class="btn btn-secondary" onclick="refreshLogs()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 4 23 10 17 10"></polyline>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
          </svg>
          Actualiser
        </button>
        <button class="btn btn-primary" onclick="exportLogs()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Exporter CSV
        </button>
      </div>
    </div>

    <!-- Stats Summary -->
    <div class="logs-stats">
      <div class="log-stat-card">
        <div class="log-stat-icon" style="background: #dbeafe;">📊</div>
        <div>
          <div class="log-stat-label">Total aujourd'hui</div>
          <div class="log-stat-value" id="logs-today">-</div>
        </div>
      </div>
      
      <div class="log-stat-card">
        <div class="log-stat-icon" style="background: #fef3c7;">👥</div>
        <div>
          <div class="log-stat-label">Utilisateurs actifs</div>
          <div class="log-stat-value" id="active-users">-</div>
        </div>
      </div>
      
      <div class="log-stat-card">
        <div class="log-stat-icon" style="background: #d1fae5;">✅</div>
        <div>
          <div class="log-stat-label">Actions réussies</div>
          <div class="log-stat-value" id="success-rate">-</div>
        </div>
      </div>
      
      <div class="log-stat-card">
        <div class="log-stat-icon" style="background: #fee2e2;">⚠️</div>
        <div>
          <div class="log-stat-label">Erreurs</div>
          <div class="log-stat-value" id="error-count">-</div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="logs-filters">
      <div class="filter-group">
        <label>🔍 Rechercher</label>
        <input type="text" id="search-input" placeholder="Rechercher dans les logs..." class="filter-input">
      </div>

      <div class="filter-group">
        <label>📅 Période</label>
        <select id="period-filter" class="filter-select" onchange="applyFilters()">
          <option value="today">Aujourd'hui</option>
          <option value="week">7 derniers jours</option>
          <option value="month" selected>30 derniers jours</option>
          <option value="all">Tout l'historique</option>
        </select>
      </div>

      <div class="filter-group">
        <label>🎯 Type d'action</label>
        <select id="action-filter" class="filter-select" onchange="applyFilters()">
          <option value="all">Toutes les actions</option>
          <option value="auth">Authentification</option>
          <option value="client">Gestion clients</option>
          <option value="quote">Devis</option>
          <option value="project">Projets</option>
          <option value="export">Exports</option>
          <option value="error">Erreurs</option>
        </select>
      </div>

      <div class="filter-group">
        <label>👤 Utilisateur</label>
        <select id="user-filter" class="filter-select" onchange="applyFilters()">
          <option value="all">Tous les utilisateurs</option>
          <!-- Chargé dynamiquement -->
        </select>
      </div>

      <button class="btn btn-secondary" style="align-self: flex-end;" onclick="clearFilters()">
        Réinitialiser
      </button>
    </div>

    <!-- Logs Table -->
    <div class="logs-container">
      <div class="logs-table-wrapper">
        <table class="logs-table">
          <thead>
            <tr>
              <th>Horodatage</th>
              <th>Utilisateur</th>
              <th>Action</th>
              <th>Type</th>
              <th>Détails</th>
              <th>IP</th>
              <th>Statut</th>
            </tr>
          </thead>
          <tbody id="logs-tbody">
            <tr>
              <td colspan="7" style="text-align: center; padding: 40px; color: #94a3b8;">
                Chargement des logs...
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="logs-pagination">
        <button class="pagination-btn" id="prev-btn" onclick="prevPage()" disabled>
          ← Précédent
        </button>
        <span id="pagination-info">Page 1 sur 1</span>
        <button class="pagination-btn" id="next-btn" onclick="nextPage()" disabled>
          Suivant →
        </button>
      </div>
    </div>
  </main>

  <script src="/js/admin_logs.js"></script>
</body>
</html>