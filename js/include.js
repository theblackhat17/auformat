// =========================================
// SYST√àME D'INCLUSION DE PARTIALS
// =========================================

async function includePartials() {
  // Attendre que le DOM soit compl√®tement charg√©
  if (document.readyState === 'loading') {
    await new Promise(resolve => {
      document.addEventListener('DOMContentLoaded', resolve);
    });
  }

  const includes = document.querySelectorAll('[data-include]');
  
  if (includes.length === 0) {
    console.warn('‚ö†Ô∏è Aucun √©l√©ment [data-include] trouv√©');
    return;
  }

  console.log(`üì¶ Chargement de ${includes.length} partial(s)...`);

  try {
    await Promise.all(
      Array.from(includes).map(async (element) => {
        const file = element.getAttribute('data-include');
        
        try {
          // ‚úÖ CORRECTION : Utiliser le chemin tel quel (relatif √† la page courante)
          const response = await fetch(file);
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          const content = await response.text();
          
          // V√©rifier que l'√©l√©ment a toujours un parent
          if (!element.parentNode) {
            console.warn(`‚ö†Ô∏è L'√©l√©ment pour ${file} n'a plus de parent`);
            return;
          }
          
          // Remplacer l'√©l√©ment par son contenu
          element.outerHTML = content;
          
          console.log(`‚úÖ Partial charg√©: ${file}`);
          
        } catch (error) {
          console.error(`‚ùå Erreur de chargement: ${file}`, error);
          // Garder l'√©l√©ment vide plut√¥t que de le supprimer
          if (element.parentNode) {
            element.innerHTML = `<!-- Erreur: ${file} -->`;
          }
        }
      })
    );

    console.log('‚úÖ Tous les partials charg√©s');
    
    // D√©clencher un √©v√©nement personnalis√© quand les partials sont charg√©s
    document.dispatchEvent(new Event('partials-loaded'));
    
  } catch (error) {
    console.error('‚ùå Erreur globale includePartials:', error);
  }
}

// Lancer l'inclusion d√®s que possible
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', includePartials);
} else {
  includePartials();
}

console.log('‚úÖ Syst√®me d\'inclusion charg√©');