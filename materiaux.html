<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nos Mat√©riaux - Au Format</title>
    <link rel="stylesheet" href="sources/css/style_materiaux.css">
    <link rel="stylesheet" href="sources/css/style_global.css">
    <link rel="icon" href="sources/img/logo_tmp.png">
</head>
<body>
    <!-- Header -->
    <div data-include="partials/header.html"></div>

    <!-- Hero Section -->
    <section class="page-hero">
        <div>
            <h1>Nos Mat√©riaux</h1>
            <p>Une s√©lection rigoureuse de bois nobles issus de for√™ts g√©r√©es durablement</p>
        </div>
    </section>

    <!-- Introduction -->
    <section class="intro-section">
        <h2>Le Bois, Notre Passion</h2>
        <p>
            Chez Au Format, nous accordons une importance capitale au choix des mat√©riaux. Chaque essence de bois poss√®de son caract√®re, ses qualit√©s et ses applications sp√©cifiques. Nous s√©lectionnons minutieusement nos bois aupr√®s de fournisseurs certifi√©s pour vous garantir des r√©alisations durables et respectueuses de l'environnement.
        </p>
        <p>
            Tous nos bois proviennent de for√™ts g√©r√©es durablement et sont certifi√©s PEFC ou FSC. Cette d√©marche √©co-responsable nous permet de contribuer √† la pr√©servation des ressources foresti√®res tout en vous offrant des mat√©riaux d'exception.
        </p>
    </section>

    <!-- Cat√©gories Navigation (DYNAMIQUE - g√©n√©r√©e selon les cat√©gories disponibles) -->
    <nav class="categories-nav" id="categories-nav">
        <!-- Les liens seront g√©n√©r√©s dynamiquement -->
    </nav>

    <!-- Container pour tous les mat√©riaux (DYNAMIQUE depuis CMS) -->
    <div id="materiaux-container">
        <div class="loading" style="text-align: center; padding: 4rem;">
            <p>Chargement des mat√©riaux...</p>
        </div>
    </div>

    <div data-include="partials/footer.html"></div>

    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <!-- Script pour charger le contenu depuis le CMS -->
    <script src="js/load-content.js"></script>

    <!-- Script pour inclure header/footer -->
    <script src="js/include.js" defer></script>

    <!-- Script principal pour charger et afficher les mat√©riaux -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadAllMateriauxPage();
        });

        // Fonction pour charger tous les mat√©riaux
        async function loadAllMateriauxPage() {
            try {
                const response = await fetch('/api/materiaux.json');
                const materiaux = await response.json();

                const container = document.getElementById('materiaux-container');
                if (!container) return;

                // Filtrer uniquement les mat√©riaux publi√©s
                const published = materiaux.filter(m => m.published !== false);

                // Grouper par cat√©gorie
                const grouped = groupByCategory(published);

                // Cr√©er la navigation des cat√©gories
                createCategoriesNav(grouped);

                // Afficher les mat√©riaux par cat√©gorie
                displayMateriauxByCategory(grouped);

                // G√©rer la navigation smooth scroll
                setupSmoothScroll();

            } catch (error) {
                console.error('Erreur lors du chargement des mat√©riaux:', error);
                const container = document.getElementById('materiaux-container');
                if (container) {
                    container.innerHTML = `
                        <div class="error-message" style="text-align: center; padding: 2rem;">
                            <p>‚ùå Impossible de charger les mat√©riaux pour le moment.</p>
                            <p style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.7;">
                                V√©rifiez que le fichier /api/materiaux.json existe.
                            </p>
                        </div>
                    `;
                }
            }
        }

        // Grouper les mat√©riaux par cat√©gorie
        function groupByCategory(materiaux) {
            const categories = {
                'nobles': { label: 'üíé Bois Nobles', subtitle: 'Les essences d\'exception pour vos r√©alisations haut de gamme', items: [] },
                'locaux': { label: 'üá´üá∑ Bois Locaux', subtitle: 'Des essences fran√ßaises pour une d√©marche √©co-responsable', items: [] },
                'exotiques': { label: 'üå¥ Bois Exotiques', subtitle: 'Des bois d\'exception venus d\'ailleurs', items: [] },
                'exterieurs': { label: 'üö™ Bois pour Ext√©rieurs', subtitle: 'R√©sistants aux intemp√©ries et au temps', items: [] }
            };

            materiaux.forEach(materiau => {
                const cat = materiau.category || 'autres';
                if (categories[cat]) {
                    categories[cat].items.push(materiau);
                }
            });

            // Supprimer les cat√©gories vides
            Object.keys(categories).forEach(key => {
                if (categories[key].items.length === 0) {
                    delete categories[key];
                }
            });

            return categories;
        }

        // Cr√©er la navigation des cat√©gories
        function createCategoriesNav(grouped) {
            const nav = document.getElementById('categories-nav');
            if (!nav) return;

            const categoryIds = {
                'nobles': 'bois-nobles',
                'locaux': 'bois-locaux',
                'exotiques': 'bois-exotiques',
                'exterieurs': 'exterieurs'
            };

            nav.innerHTML = Object.entries(grouped).map(([key, data], index) => `
                <a href="#${categoryIds[key] || key}" class="category-btn ${index === 0 ? 'active' : ''}">
                    ${data.label}
                </a>
            `).join('');
        }

        // Afficher les mat√©riaux group√©s par cat√©gorie
        function displayMateriauxByCategory(grouped) {
            const container = document.getElementById('materiaux-container');

            const categoryIds = {
                'nobles': 'bois-nobles',
                'locaux': 'bois-locaux',
                'exotiques': 'bois-exotiques',
                'exterieurs': 'exterieurs'
            };

            container.innerHTML = Object.entries(grouped).map(([key, data]) => `
                <section class="materiaux-section" id="${categoryIds[key] || key}">
                    <h2 class="section-title">${data.label}</h2>
                    <p class="section-subtitle">${data.subtitle}</p>

                    <div class="materiaux-grid">
                        ${data.items.map(materiau => createMateriauCard(materiau)).join('')}
                    </div>
                </section>
            `).join('');
        }

        // Cr√©er une carte de mat√©riau
        function createMateriauCard(materiau) {
            const stars = (count) => '‚òÖ'.repeat(count) + '‚òÜ'.repeat(5 - count);
            const hardness = stars(materiau.hardness || 3);
            const stability = stars(materiau.stability || 3);

            return `
                <div class="materiau-card">
                    <div class="materiau-image">
                        <img src="${materiau.image}" 
                             alt="${materiau.name}" 
                             loading="lazy">
                        <div class="materiau-tag">${materiau.tag || 'Premium'}</div>
                    </div>
                    <div class="materiau-content">
                        <div class="materiau-header">
                            <div>
                                <h3 class="materiau-name">${materiau.name}</h3>
                                ${materiau.latinName ? `<p class="materiau-latin">${materiau.latinName}</p>` : ''}
                            </div>
                        </div>
                        <p class="materiau-description">
                            ${materiau.description}
                        </p>
                        
                        <div class="materiau-specs">
                            <div class="spec-item">
                                <span class="spec-label">Duret√©</span>
                                <span class="spec-value">${hardness}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Stabilit√©</span>
                                <span class="spec-value">${stability}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Origine</span>
                                <span class="spec-value">${materiau.origin || 'Non sp√©cifi√©'}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Teinte</span>
                                <span class="spec-value">${materiau.color || 'Variable'}</span>
                            </div>
                        </div>

                        ${materiau.features && materiau.features.length > 0 ? `
                            <ul class="materiau-features">
                                ${materiau.features.map(f => `<li>${f.feature || f}</li>`).join('')}
                            </ul>
                        ` : ''}

                        ${materiau.usages && materiau.usages.length > 0 ? `
                            <div class="materiau-usage">
                                ${materiau.usages.map(u => `<span class="usage-badge">${u.usage || u}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Configuration du smooth scroll pour la navigation
        function setupSmoothScroll() {
            const categoryBtns = document.querySelectorAll('.category-btn');
            
            categoryBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Retirer active de tous les boutons
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    // Ajouter active au bouton cliqu√©
                    this.classList.add('active');
                    
                    // Scroll vers la section
                    const targetId = this.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);
                    
                    if (targetSection) {
                        const navHeight = document.querySelector('.categories-nav').offsetHeight;
                        const targetPosition = targetSection.offsetTop - navHeight - 20;
                        
                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Mise √† jour du bouton actif au scroll
            window.addEventListener('scroll', () => {
                const sections = document.querySelectorAll('.materiaux-section');
                const navHeight = document.querySelector('.categories-nav')?.offsetHeight || 0;
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop - navHeight - 100;
                    const sectionBottom = sectionTop + section.offsetHeight;
                    const scrollPosition = window.scrollY;
                    
                    if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                        const id = section.getAttribute('id');
                        categoryBtns.forEach(btn => {
                            btn.classList.remove('active');
                            if (btn.getAttribute('href') === `#${id}`) {
                                btn.classList.add('active');
                            }
                        });
                    }
                });
            });
        }

        // Gestion Netlify Identity
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        }
    </script>

    <!-- Fallback si JS d√©sactiv√© -->
    <noscript>
        <div style="padding: 2rem; text-align: center; background: #f5f1e8;">
            <p>Activez JavaScript pour afficher les mat√©riaux.</p>
        </div>
    </noscript>
</body>
</html>